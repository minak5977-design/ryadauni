<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Smart Maintenance System</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #4361ee;
            --success: #06d6a0;
            --danger: #ef476f;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --glass: rgba(255, 255, 255, 0.95);
        }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            background: url('https://a.top4top.io/p_36115ao3o1.jpg') no-repeat center center fixed;
            background-size: cover;
            display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px;
        }
        /* Ø®Ù„ÙÙŠØ© Ø¶Ø¨Ø§Ø¨ÙŠØ© Ø¯Ø§ÙƒÙ†Ø© */
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(8px); z-index: -1; }

        .app-card {
            width: 100%; max-width: 450px;
            background: var(--glass); border-radius: 24px; padding: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4); position: relative;
            max-height: 90vh; overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .hidden { display: none !important; }

        /* Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        .brand { text-align: center; margin-bottom: 25px; }
        .brand i { font-size: 45px; color: var(--primary); background: #e0e7ff; padding: 15px; border-radius: 20px; margin-bottom: 10px; }
        .brand h1 { margin: 0; color: var(--dark); font-size: 22px; font-weight: 800; }
        
        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tabs { display: flex; background: #e9ecef; padding: 5px; border-radius: 15px; margin-bottom: 25px; }
        .tab { flex: 1; text-align: center; padding: 12px; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 700; color: #6c757d; transition: 0.3s; }
        .tab.active { background: #fff; color: var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

        /* Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        .input-group { margin-bottom: 15px; position: relative; }
        .input-group label { display: block; font-size: 13px; font-weight: 700; margin-bottom: 8px; color: var(--dark); }
        .modern-input { 
            width: 100%; padding: 16px; padding-right: 45px; /* Ù…Ø³Ø§ÙØ© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
            border: 2px solid #dee2e6; border-radius: 14px; 
            font-size: 15px; outline: none; transition: 0.3s; background: #fff;
        }
        .modern-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.15); }
        .input-icon { position: absolute; top: 45px; right: 15px; color: #adb5bd; font-size: 18px; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn { width: 100%; padding: 16px; border: none; border-radius: 14px; font-size: 16px; font-weight: 700; cursor: pointer; color: white; transition: 0.2s; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-top: 10px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #3f37c9); }
        .btn-primary:active { transform: scale(0.98); }
        .btn:disabled { background: #ced4da; cursor: not-allowed; }

        /* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Ø± */
        .roles-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .role-card { 
            background: #fff; border: 2px solid #dee2e6; border-radius: 14px; padding: 15px 5px; 
            text-align: center; cursor: pointer; transition: 0.2s; 
        }
        .role-card i { font-size: 24px; color: #adb5bd; display: block; margin-bottom: 5px; }
        .role-card span { font-size: 12px; font-weight: 700; color: #495057; }
        
        .role-card.selected { border-color: var(--primary); background: #e0e7ff; }
        .role-card.selected i, .role-card.selected span { color: var(--primary); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        .app-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logout-btn { background: #ffe5ec; color: var(--danger); border: none; padding: 8px 15px; border-radius: 10px; font-weight: 700; font-size: 12px; cursor: pointer; }

        /* ÙƒØ±ÙˆØª Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª */
        .report-card { background: #fff; border-radius: 16px; padding: 20px; margin-bottom: 15px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.02); position: relative; }
        .status-badge { position: absolute; top: 20px; left: 20px; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; }
        .bg-new { background: #e0f2fe; color: #0284c7; }
        .bg-accepted { background: #d1fae5; color: #059669; }
        
        .action-row { display: flex; gap: 10px; margin-top: 15px; }
        .action-btn-sm { flex: 1; padding: 10px; border-radius: 10px; border: none; font-weight: bold; font-size: 13px; cursor: pointer; color: white; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #splashScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="splashScreen">
        <i class="fas fa-tools fa-3x fa-spin" style="color:var(--primary); margin-bottom:20px;"></i>
        <h3 style="color:var(--dark);">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</h3>
    </div>

    <div id="authScreen" class="app-card">
        <div class="brand">
            <i class="fas fa-shield-alt"></i>
            <h1>Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…ÙˆØ­Ø¯</h1>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="setTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</div>
            <div class="tab" onclick="setTab('register')">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
        </div>

        <div id="loginForm">
            <div class="input-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <i class="fas fa-envelope input-icon"></i>
                <input type="email" id="loginEmail" class="modern-input" placeholder="example@email.com" dir="ltr">
            </div>
            <div class="input-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <i class="fas fa-lock input-icon"></i>
                <input type="password" id="loginPass" class="modern-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="btn btn-primary" onclick="login()">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† <i class="fas fa-arrow-left"></i></button>
        </div>

        <div id="registerForm" class="hidden">
            <label style="font-size:13px; font-weight:700; margin-bottom:10px; display:block;">Ø§Ø®ØªØ± ÙˆØ¸ÙŠÙØªÙƒ</label>
            <div class="roles-grid">
                <div class="role-card" onclick="selectRole('employee', this)"><i class="fas fa-user-tie"></i><span>Ù…ÙˆØ¸Ù</span></div>
                <div class="role-card" onclick="selectRole('supervisor', this)"><i class="fas fa-user-shield"></i><span>Ù…Ø´Ø±Ù</span></div>
                <div class="role-card" onclick="selectRole('technician', this)"><i class="fas fa-tools"></i><span>ÙÙ†ÙŠ</span></div>
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                <i class="fas fa-user input-icon"></i>
                <input type="text" id="regName" class="modern-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ">
            </div>

            <div class="input-group">
                <label>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„ (Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†)</label>
                <i class="fas fa-building input-icon"></i>
                <input type="text" id="regWork" class="modern-input" placeholder="ÙƒÙ„ÙŠØ© - Ù…Ø¨Ù†Ù‰ - ØºØ±ÙØ©">
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <i class="fas fa-envelope input-icon"></i>
                <input type="email" id="regEmail" class="modern-input" placeholder="example@email.com" dir="ltr">
            </div>

            <div class="input-group">
                <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</label>
                <i class="fas fa-key input-icon"></i>
                <input type="password" id="regPass" class="modern-input" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„">
            </div>

            <button class="btn btn-primary" onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ ğŸš€</button>
        </div>
        
        <p id="msg" style="text-align:center; margin-top:15px; font-weight:bold; font-size:13px; color:var(--danger);"></p>
    </div>

    <div id="mainScreen" class="app-card hidden">
        <div class="app-header">
            <div class="user-info">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="user-avatar">
                <div>
                    <h3 id="uName" style="margin:0; font-size:16px; color:var(--dark);">User</h3>
                    <span id="uRoleBadge" style="font-size:12px; color:#6b7280;">Role</span>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
        </div>

        <div id="viewEmployee" class="hidden">
            <h3 style="font-size:16px; margin-bottom:15px;">ğŸ“ ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯</h3>
            
            <div style="background:#f8f9fa; border:2px dashed #dee2e6; border-radius:15px; padding:20px; text-align:center; cursor:pointer; margin-bottom:15px;" onclick="document.getElementById('fileIn').click()">
                <i class="fas fa-camera fa-2x" style="color:#adb5bd;"></i>
                <p style="margin:5px 0 0; font-size:13px; color:#6c757d;">Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ± Ù„Ù„Ø¹Ø·Ù„</p>
            </div>
            <div id="previewBox" style="display:flex; gap:5px; margin-bottom:10px;"></div>
            <input type="file" id="fileIn" multiple accept="image/*" class="hidden" onchange="preview(this)">

            <input type="text" id="loc" class="modern-input" placeholder="Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ø·Ù„ Ø¨Ø§Ù„ØªÙØµÙŠÙ„" style="margin-bottom:10px;">
            <textarea id="desc" class="modern-input" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©..." style="margin-bottom:10px;"></textarea>
            
            <button class="btn btn-primary" onclick="submitReport()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù„Ø§Øº</button>
            <h4 style="margin-top:20px; font-size:15px;">Ø­Ø§Ù„Ø© Ø¨Ù„Ø§ØºØ§ØªÙŠ:</h4>
            <div id="empHistory"></div>
        </div>

        <div id="viewSupervisor" class="hidden">
            <h3 style="font-size:16px; margin-bottom:15px;">ğŸ“‹ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
            <div id="supList" style="text-align:center; color:#999;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div id="viewTechnician" class="hidden">
            <h3 style="font-size:16px; margin-bottom:15px;">ğŸ”§ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
            <div id="techList" style="text-align:center; color:#999;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <p id="appMsg" style="text-align:center; margin-top:10px; font-weight:bold;"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, onSnapshot, query, orderBy, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // âš ï¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ âš ï¸
        const firebaseConfig = {
            apiKey: "AIzaSyBojgV1qxSkf16W1gMMjuKm9zF4daDEaFs",
            authDomain: "nursing-attendance.firebaseapp.com",
            databaseURL: "https://nursing-attendance-default-rtdb.firebaseio.com",
            projectId: "nursing-attendance",
            storageBucket: "nursing-attendance.firebasestorage.app",
            messagingSenderId: "935107068390",
            appId: "1:935107068390:web:60c1dad67bfc9125191627"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        let selectedRole = null;

        // 1. Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        window.setTab = (t) => {
            document.querySelectorAll('.tab').forEach(el=>el.classList.remove('active'));
            if(t==='login') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('registerForm').classList.add('hidden');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            }
        };

        window.selectRole = (r, el) => {
            selectedRole = r;
            document.querySelectorAll('.role-card').forEach(c=>c.classList.remove('selected'));
            el.classList.add('selected');
        };

        // 2. Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        window.register = async () => {
            const name = document.getElementById('regName').value;
            const work = document.getElementById('regWork').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const msg = document.getElementById('msg');

            if(!selectedRole || !name || !email || pass.length < 6) {
                msg.innerText = "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± 6 Ø£Ø­Ø±Ù)"; return;
            }

            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨..."; msg.style.color="blue";

            try {
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                await setDoc(doc(db, "users", cred.user.uid), {
                    uid: cred.user.uid,
                    name, work, email, role: selectedRole,
                    createdAt: serverTimestamp()
                });
                msg.innerText = "";
                // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø³ÙŠØªÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            } catch(e) {
                if(e.code === 'auth/email-already-in-use') msg.innerText = "Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹!";
                else msg.innerText = "Ø®Ø·Ø£: " + e.message;
                msg.style.color="red";
            }
        };

        // 3. Ø§Ù„Ø¯Ø®ÙˆÙ„
        window.login = async () => {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            const msg = document.getElementById('msg');

            if(!email || !pass) { msg.innerText = "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"; return; }
            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..."; msg.style.color="blue";

            try {
                await signInWithEmailAndPassword(auth, email, pass);
                msg.innerText = "";
            } catch(e) {
                msg.innerText = "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ";
                msg.style.color="red";
            }
        };

        // 4. Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø°ÙƒÙŠ
        onAuthStateChanged(auth, async (user) => {
            if(user) {
                const snap = await getDoc(doc(db, "users", user.uid));
                if(snap.exists()) {
                    openApp(snap.data());
                }
            } else {
                document.getElementById('splashScreen').style.display='none';
                document.getElementById('authScreen').classList.remove('hidden');
                document.getElementById('mainScreen').classList.add('hidden');
            }
        });

        function openApp(user) {
            document.getElementById('splashScreen').style.display='none';
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');

            document.getElementById('uName').innerText = user.name;
            let roleAr = user.role==='supervisor'?'Ù…Ø´Ø±Ù':(user.role==='technician'?'ÙÙ†ÙŠ':'Ù…ÙˆØ¸Ù');
            document.getElementById('uRoleBadge').innerText = roleAr;

            document.getElementById('viewEmployee').classList.add('hidden');
            document.getElementById('viewSupervisor').classList.add('hidden');
            document.getElementById('viewTechnician').classList.add('hidden');

            if(user.role === 'employee') {
                document.getElementById('viewEmployee').classList.remove('hidden');
                loadEmpHistory(user.uid);
            } else if(user.role === 'supervisor') {
                document.getElementById('viewSupervisor').classList.remove('hidden');
                loadSupervisor();
            } else if(user.role === 'technician') {
                document.getElementById('viewTechnician').classList.remove('hidden');
                loadTechnician();
            }
        }

        // --- Ø§Ù„Ù…ÙˆØ¸Ù ---
        window.preview = (inp) => {
            const box = document.getElementById('previewBox'); box.innerHTML="";
            for(let f of inp.files) {
                let img = document.createElement('img'); img.src = URL.createObjectURL(f);
                img.style.width="50px"; img.style.height="50px"; img.style.borderRadius="8px";
                box.appendChild(img);
            }
        };

        window.submitReport = async () => {
            const desc = document.getElementById('desc').value;
            if(!desc) return alert("Ø§ÙƒØªØ¨ Ø§Ù„ÙˆØµÙ");
            
            document.getElementById('appMsg').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";
            const uid = auth.currentUser.uid;
            const uData = (await getDoc(doc(db,"users",uid))).data();

            let urls = [];
            for(let f of document.getElementById('fileIn').files) {
                const r = ref(storage, 'reports/'+Date.now()+'_'+f.name);
                await uploadBytes(r, f);
                urls.push(await getDownloadURL(r));
            }

            await addDoc(collection(db, "maintenance_reports"), {
                uid, name: uData.name, work: uData.work, desc, 
                loc: document.getElementById('loc').value,
                images: urls, status: 'new', timestamp: serverTimestamp()
            });

            document.getElementById('appMsg').innerText = "ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ âœ…";
            setTimeout(()=>{ document.getElementById('appMsg').innerText=""; document.getElementById('desc').value=""; }, 2000);
        };

        function loadEmpHistory(uid) {
            const q = query(collection(db, "maintenance_reports"), where("uid", "==", uid), orderBy("timestamp", "desc"));
            onSnapshot(q, snap => {
                const list = document.getElementById('empHistory'); list.innerHTML="";
                snap.forEach(d => {
                    const data = d.data();
                    let stText = data.status==='new'?'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©':(data.status==='accepted'?'ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„ (Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥ØµÙ„Ø§Ø­)':'Ù…Ø±ÙÙˆØ¶');
                    let color = data.status==='new'?'orange':(data.status==='accepted'?'green':'red');
                    list.innerHTML += `<div style="background:#fff; padding:10px; border-radius:10px; margin-bottom:5px; border:1px solid #eee; font-size:13px;">
                        <span style="color:${color}; font-weight:bold;">â— ${stText}</span><br>
                        ${data.desc}
                    </div>`;
                });
            });
        }

        // --- Ø§Ù„Ù…Ø´Ø±Ù ---
        function loadSupervisor() {
            const q = query(collection(db, "maintenance_reports"), orderBy("timestamp", "desc"));
            onSnapshot(q, snap => {
                const list = document.getElementById('supList'); list.innerHTML="";
                snap.forEach(d => {
                    const data = d.data();
                    let btns = "";
                    if(data.status === 'new') {
                        btns = `<div class="action-row">
                            <button class="action-btn-sm" style="background:var(--success)" onclick="updateSt('${d.id}','accepted')">âœ” Ù‚Ø¨ÙˆÙ„ ÙˆØªØ­ÙˆÙŠÙ„</button>
                            <button class="action-btn-sm" style="background:var(--danger)" onclick="updateSt('${d.id}','rejected')">âœ˜ Ø±ÙØ¶</button>
                        </div>`;
                    }
                    let badge = data.status==='new'?'bg-new':(data.status==='accepted'?'bg-accepted':'');
                    
                    list.innerHTML += `
                    <div class="report-card">
                        <span class="status-badge ${badge}">${data.status}</span>
                        <h4 style="margin:20px 0 5px 0">${data.name}</h4>
                        <div style="font-size:12px; color:#666; margin-bottom:10px;">${data.loc} (${data.work})</div>
                        <p style="color:#333; font-size:14px;">${data.desc}</p>
                        ${btns}
                    </div>`;
                });
            });
        }

        // --- Ø§Ù„ÙÙ†ÙŠ ---
        function loadTechnician() {
            const q = query(collection(db, "maintenance_reports"), where("status", "==", "accepted"));
            onSnapshot(q, snap => {
                const list = document.getElementById('techList'); list.innerHTML="";
                if(snap.empty) list.innerHTML="Ù„Ø§ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹";
                snap.forEach(d => {
                    const data = d.data();
                    list.innerHTML += `
                    <div class="report-card">
                        <h4 style="margin:0 0 10px 0;">${data.loc}</h4>
                        <p>${data.desc}</p>
                        <button class="btn btn-primary" style="margin-top:10px; font-size:13px;" onclick="updateSt('${d.id}','completed')">âœ… ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</button>
                    </div>`;
                });
            });
        }

        window.updateSt = async (id, st) => {
            await updateDoc(doc(db, "maintenance_reports", id), { status: st });
        };

        window.logout = () => { if(confirm("Ø®Ø±ÙˆØ¬ØŸ")) auth.signOut().then(()=>location.reload()); };
    </script>
</body>
</html>
